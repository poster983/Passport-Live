<div id="accountInfo" class="accountInfoOverlay">
  
  <div class="userCardBundle">
    <!--Top Card -->
    <div class="row">
      <div class="col s12 m12 l8 push-l2">
        <div class="card small">
          <div class="card-image">
            <img src="/api/media/background/{{user.id}}.svg">
          </div>
          <div class="card-content">
            <div class="card-avatar">
              <img src="/api/media/avatar/{{user.id}}/100.svg" alt="Avatar" id="userCardBundleAvatar" class="card-avatar circle responsive-img">
            </div>
            <br>
            <span class="card-title black-text center">Salutation. FirstName LastName <i class="material-icons" title="User has verified their email">verified_user</i><i class="material-icons" title="User is archived">archive</i></span>
          </div>
        </div>
      </div>
    </div>
    <!--Universal Info -->
    <div class="row">
      <div class="col s12 m12 l4 push-l2">
        <div class="card">
          <div class="card-content">
           <span class="card-title">Universal Info</span>
             <span title="Account ID"><i class="material-icons">assignment_ind</i> <strong>4564651asd654f56ds4564</strong></span>
             <br><br>
             <span><i class="material-icons">email</i> <strong>josephh2018@gmail.com</strong></span>
          </div>
        </div>
      </div>

      <!--Current Location Info -->
      <!--<div class="col s12 m12 l4 push-l2">

        <div class="card">
          <div class="card-content">
           <span class="card-title">Current Location</span>

             <table class="highlight">
              <thead>
                <tr>
                  <th><i class="material-icons left">insert_photo</i></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">today</i>Schedule</a></th>
                </tr>
              </thead>
              <tbody>
                <tr title="Room Number">
                  <td><i class="material-icons left">room</i></td>
                  <td>123456</td>
                  <td>123456</td>
                  <td>123456</td>
                  <td>123456</td>
                </tr>
                <tr title="Person With">
                  <td><i class="material-icons left">person_pin_circle</i></td>
                  <td>Mr. Camron Thomas</td>
                  <td>Mr. Camron Thomas</td>
                  <td>Mr. Camron Thomas</td>
                  <td>Ms. Jinnafer Humtidinkle</td>
                </tr>
                <tr title="Class">
                  <td><i class="material-icons left">class</i></td>
                  <td>English</td>
                  <td>English</td>
                  <td>English</td>
                  <td>Study Hall</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-content">
           <span class="card-title">Current Location</span>
             
          </div>
        </div>
      </div>-->

    </div>
    <!--Current Location Info -->
    <div class="row">
      
      <div class="col s12 m12 l8 push-l2">

        <div class="card">
          <div class="card-content">
           <span class="card-title">Current Location</span>

             <table class="highlight">
              <thead>
                <tr>
                  <th><i class="material-icons left">insert_photo</i></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">today</i>Schedule</a></th>
                </tr>
              </thead>
              <tbody>
                <tr title="Room Number">
                  <td><i class="material-icons left">room</i></td>
                  <td>123456</td>
                  <td>123456</td>
                  <td>123456</td>
                  <td>123456</td>
                </tr>
                <tr title="Person With">
                  <td><i class="material-icons left">person_pin_circle</i></td>
                  <td>Mr. Camron Thomas</td>
                  <td>Mr. Camron Thomas</td>
                  <td>Mr. Camron Thomas</td>
                  <td>Ms. Jinnafer Humtidinkle</td>
                </tr>
                <tr title="Class">
                  <td><i class="material-icons left">class</i></td>
                  <td>English</td>
                  <td>English</td>
                  <td>English</td>
                  <td>Study Hall</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="row" >
      <div class="col s12 m12 l8 push-l2">
        <div class="card" >
           
          <div class="card-content">
            <span class="card-title">Schedule</span>
            <table class="highlight responsive-table">
              <thead>
                <tr>
                    <th>Period</th>
                    <th>Class</th>
                    <th>Teacher</th>
                    <th>Room</th>
                </tr>
              </thead>

              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>


<script type="text/javascript">
  /*
  let accountOverlay = {};
  accountOverlay._compile = {};

  accountOverlay.new = function(id) {
    
  }

  //Private
  accountOverlay._compile.topCard = function(nameJson, )
  */



  let AccountOverlay = (function() {
    let _userID = new WeakMap();
    let _user = new WeakMap();
    let _location = new WeakMap();
    class AccountOverlay {
      constructor(userID, done) {
        _userID.set(this, userID);
        console.log(this)
        var prom = [];
        prom.push(new Promise(function(resolve, reject) {
          $.ajax({
            type: "get",
            url: "/api/account/id/" + userID + "/",
            dataType: "json",
            beforeSend: function(xhr){xhr.setRequestHeader('X-XSRF-TOKEN', getCookie("XSRF-TOKEN"));},
            success: function(data) {_user.set(this, data); resolve()}.bind(this),
            error: function(jqXHR) {reject(jqXHR)}                      
          });
        }.bind(this)));
        prom.push(new Promise(function(resolve, reject) {
          //" + new Date().toISOString() + "
          $.ajax({
            type: "get",
            url: "/api/account/location/datetime/2017-09-07T10:55:30.652-05:00/id/" + userID + "/",
            dataType: "json",
            beforeSend: function(xhr){xhr.setRequestHeader('X-XSRF-TOKEN', getCookie("XSRF-TOKEN"));},
            success: function(data) {_location.set(this, data); resolve()}.bind(this),
            error: function(jqXHR) {reject(jqXHR)}                      
          });
        }.bind(this)));

        Promise.all(prom).then(function(data) {
          console.log(_location.get(this))
          done(null)
        }.bind(this)).catch(function(err) {
          done(err)
        })
      };

      getLocation() {

      }
      get user() {
        return _user.get(this);
      };

      topCard() {
        var top = $("<div/>").addClass("col s12 m12 l8 push-l2");

        var image = $("<div/>")
                      .addClass("card-image")
                      .append(
                        $("<img/>")
                          .attr("src", "/api/media/background/" + _user.get(this).id + ".svg")
                      )
        
        var cont = $("<div/>")
                      .addClass("card-content")
                      .append(
                        $("<div/>")
                          .addClass("card-avatar")
                          .append(
                            $("<img/>")
                              .addClass("card-avatar circle responsive-img")
                              .attr("alt", "Avatar")
                              .attr("src", "/api/media/avatar/" + _user.get(this).id + "/100.svg")
                          )
                      ).append(
                        $("<br/>")
                      )
        var nameThing = $("<span/>")
                        .addClass("card-title black-text center")
                        .html(_user.get(this).name.salutation + " " + _user.get(this).name.first + " " + _user.get(this).name.last)
        
        if(_user.get(this).isVerified) {
          nameThing.append(
                $("<i/>").addClass("material-icons").attr("title", "User has verified their email").html("verified_user")
            )
        }

        if(_user.get(this).isArchived) {
          nameThing.append(
                $("<i/>").addClass("material-icons").attr("title", "User is archived").html("archive")
            )
        }

        return top.append($("<div/>").addClass("card small")
                  .append(image)
                  .append(cont.append(nameThing))
                )
      }

      universalInfoCard() {
        var top = $("<div/>").addClass("col s12 m12 l4 push-l2");
        var id = $("<span/>")
                        .attr("title", "Account ID") 
                        .prepend($("<i/>").addClass("material-icons").html("assignment_ind"))
                        .append($("<strong/>").html(_user.get(this).id))
        var email = $("<span/>")
                        .attr("title", "Email") 
                        .prepend($("<i/>").addClass("material-icons").html("email"))
                        .append($("<strong/>").html(_user.get(this).email))
        var cont = $("<div/>")
                      .addClass("card-content")
                      .append($("<span/>").addClass("card-title").html("Universal Info"))
                      .append(id)
                      .append($("<br/>"))
                      .append($("<br/>"))
                      .append(email)

        return top.append($("<div/>").addClass("card")
            .append(cont)
          )
      }
      /*
      <tr>
                  <th><i class="material-icons left">insert_photo</i></th>
                  <th><i class="material-icons">receipt</i>Pass</a></th>
                  <th><i class="material-icons">today</i>Schedule</a></th>
                </tr>
                */
      currentLocationCard() {
        var top = $("<div/>").addClass("col s12 m12 l4 push-l2");

        var tHead = $("<thead/>").append($("<tr/>")
                      .append($("<th/>").append($("<i/>").addClass("material-icons").html("insert_photo")))
                      .append($("<th/>").html("Pass").prepend($("<i/>").addClass("material-icons").html("receipt")))
                      .append($("<th/>").html("Schedule").prepend($("<i/>").addClass("material-icons").html("today")))
        );

        //var tBody = 

        var cont = $("<div/>")
                      .addClass("card-content")
                      .append($("<span/>").addClass("card-title").html("Current Location"))
                      .append($("<table/>").addClass("highlight").append(tHead).append("hi"))


      return top.append($("<div/>").addClass("card")
            .append(cont)
          )

      }

      generateOverlay(id, active) {

        if(active) {
          active = "active"
        } else {
          active = "";
        }

        if($("#"+id).length > 0) {
          this.deleteOverlay(id)
        }
        
        
        $("body").prepend($("<div/>").attr("id", id).addClass("accountInfoOverlay " + active).prepend(
          $("<div/>").addClass("userCardBundle").append($("<div/>").addClass("row").append(this.topCard()))
            .append($("<div/>").addClass("row")
              .append(this.universalInfoCard())
              .append(this.currentLocationCard())
          )
        ));
        $(window).click(function() {
          this.closeOverlay(id)
          
        }.bind(this));
        $("#"+id+" .userCardBundle").click(function(event){
          event.stopPropagation();
        });
      }
      closeOverlay(id) {
        $("#"+id).removeClass("active")
        
      }
      deleteOverlay(id) {
        $("#"+id).remove();
      }
      openOverlay(id) {
        $("#"+id).addClass("active")
      }
    };
    return AccountOverlay;
 }());

  
</script>